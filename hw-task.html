<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Вариант 8</title>
</head>

<body>
  <h2>Вариант 8</h2>
  <p>Реализовать операцию map для асинхронного массива.</p>
  <pre>
    function map(
        array: AsyncArray,
        fn: (cur: any, idx: Number, src: AsyncArray) => any,
        cb: (result: AsyncArray) => void) {

    }
  </pre>

  <script src="shri-async-hw.js"></script>

  <script>
    const promisifyAsyncFunction = (fn, ...args) => {
      return new Promise(resolve => {
        fn(...args, result => resolve(result));
      });
    }

    const map = async (array, fn, cb) => {
      let length = await promisifyAsyncFunction(array.length);
      let results = new AsyncArray();

      let index = 0;
      let check = await promisifyAsyncFunction(less, index, length)

      while (check) {
        let currentValue = await promisifyAsyncFunction(array.get, index);
        let newValue = fn(currentValue, index, array);
        promisifyAsyncFunction(results.push, newValue);

        index = await promisifyAsyncFunction(add, index, 1);
        check = await promisifyAsyncFunction(less, index, length);
      }

      cb(results);
    };
  </script>

</body>

</html>